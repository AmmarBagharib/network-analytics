---
title: "Individual Project"
author: "Ammar"
date: "2023-09-03"
output: 
  bookdown::html_document2:
      toc: true
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = '/Users/ammarbagharib/git/dba4713')
knitr::opts_chunk$set(echo = FALSE)
```

```{r load-packages, message=FALSE, warning=FALSE}
library(igraph)
library(here)
library(data.table)
library(ggplot2)
library(hrbrthemes)
library(ggpubr)
```

# Qn 1a


```{r graph-structure }
## Graph Structure
# Step 1: Read the edge list from the .txt file
file_path_2000 <- here("indiv-project/trade-network/2000.net")
g2000 <- read_graph(file_path_2000,format="pajek")

#str(g2000)
```

## Graph Level Attributes

**Number of Nodes:** `r vcount(g2000)`

**Number of Edges:** `r ecount(g2000)`

**Graph Density:** `r graph.density(g2000)`

**Graph Diameter:** `r diameter(g2000)`

**Size of largest Component:** `r max(components(g2000)$csize)`

**Global Transitivity:** `r transitivity(g2000,type="global")`

**Average Transitivity** `r transitivity(g2000,type="average") `

**Size of Largest Clique:** `r clique_num(g2000)`

There are 161 countries represented in the trade network and a total of 16,335 trade relationships (edges) in the network, indicating a **relatively dense** network.The graph density is approximately 0.634, which suggests that about 63.4% of all possible trade relationships between countries are present. This indicates a **relatively connected** network. The diameter of the graph is 558.699. This represents the longest shortest path between any two countries in the trade network, which is a measure of the network's overall size.

The entire network forms a single connected component with all 161 countries, indicating that there are **no isolated subnetworks**.The global transitivity (clustering coefficient) is approximately 0.842, suggesting that there is a **significant tendency** for groups of countries to engage in trade with one another, forming clusters or communities within the network. The average transitivity is approximately 0.871, which is similar to the global transitivity. This further confirms a **high degree of clustering** within the network. The largest clique in the network consists of 81 countries. This indicates the **presence of a highly interconnected group of countries** that trade extensively with each other.

[Back to top](#) 

## Vertex Attributes

```{r vertex-attributes}
# store attributes into a data.frame
df=data.frame(vertex_id=V(g2000),
              vertex_name=V(g2000)$name,
              degree=degree(g2000),
              closeness=closeness(g2000),
              betweenness=betweenness(g2000,normalized=T),
              transitivity=transitivity(g2000,type="local"),
              eigen_centrality=eigen_centrality(g2000)$vector
              )
knitr::kable(
  summary(df[-c(1,2)]),
  caption = "Vertex Attributes"
)
```

### Betweenness and Transitivity

**Betweenness Centrality:** 

- Betweenness centrality measures how often a country acts as a bridge or intermediary in trade relationships between other countries. The values range from 0 to a maximum of 0.236006, indicating variations in the importance of countries in facilitating trade routes.

- The values are still pretty much quite low, indicating that most countries do not rely on thir party channels to do trade with a country of interest.

**Transitivity:**

- The values range from 0.7591 to 0.9933, suggesting that many countries form tightly interconnected groups in trade networks.

[Back to top](#) 

```{r hist-plot-function}
#create histogram function
hist_plot <- function(table, title, xlab, ylab){
  ggplot(table, aes(x = factor(V1, levels = unique(V1)), y = N)) +
  geom_bar(stat = "identity", fill = "grey") +
  geom_text(aes(label = N), vjust = -0.3) +  # Add labels above the bars
  labs(
    title = title,
    x = xlab,
    y = ylab
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
```

### Closeness Distribution

```{r filtered-close-plot, fig.cap="Filtered Closeness Distribution"}
#closeness for each node - there are NaN values
closeness_values <- closeness(g2000)


# Find vertices with NaN closeness centrality
nan_vertices <- which(is.nan(closeness_values))

# Remove vertices with NaN closeness centrality from the graph
g2000_filtered <- delete.vertices(g2000, nan_vertices)

#explore out closeness
closeness_vector <- closeness(g2000_filtered, mode="out")
max_closeness <- max(closeness_vector)
min_closeness <- min(closeness_vector)

close_table <- data.table(
  table(
    cut(closeness_vector, breaks = seq(min_closeness, max_closeness, 
                                       by=(max_closeness - min_closeness)/10), 
        right = TRUE))
  )

# Create a histogram
hist_plot(
  table=close_table,
  title="Out Closeness Distribution",
  xlab="Closeness", 
  ylab="Number of Countries"
  )
```

**Mean Closeness Centrality in "out" Mode:** These values measure how quickly information or influence can flow from a specific vertex (country) to all other vertices in the network. It assesses how efficiently each country can disseminate information or resources to others

Overall, the out-closeness centrality values are generally very low, with a maximum of no more than 0.00116. Nonetheless, here are some findings:

Based on Figure \@ref(fig:filtered-close-plot) over 120 out of 161 countries have out-closeness centrality $\ge$ 0.000702, which is relatively high.

- The presence of `r length(nan_vertices)` countries with missing closeness centrality values suggests that these countries might only accept imports and not do exports.

[Back to top](#) 

### Eigen Centrality

```{r eigen-plot, eval=FALSE, fig.cap="Eigen", include=FALSE}
hist(
  eigen_centrality(g2000)$vector,
  main="Eigen Centrality Distribution",
  xlab="Eigen Centrality",
  ylab="Number of Countries"
  )
```

```{r filtered-eigen-plot, fig.cap="subset of Eigen Centrality" }
eigen_cent_table <- data.table(
  table(cut(eigen_centrality(g2000)$vector, breaks = seq(0, 0.01, by=0.001), 
        right = TRUE))
  )

# Create a histogram
hist_plot(
  table=eigen_cent_table,
  title="Eigen Centrality Distribution",
  xlab="Eigen Centrality", 
  ylab="Number of Countries"
  )
```

Based on Figure \@ref(fig:filtered-eigen-plot) 59 countries have eigen centrality values of between 0 to 0.001, and this forms the majority of the countries.  

- Countries with eigen centrality values in this range are likely to be less influential in the global trade network. They may have limited trade connections or trade relationships that are not strongly influential on a global scale.

- These countries may not play a significant role in shaping global trade patterns. They might have relatively small trade volumes or trade primarily with a limited set of partners.

- Their influence on the network's structure and dynamics is relatively low, and they are less likely to act as intermediaries in trade routes.

The second largest group of countries, approximately 17, have eigen centrality values of between 0.001 to 0.002.

- Countries falling within this range have a somewhat more significant influence on the trade network compared to those in the lower eigen centrality range. They may have more extensive trade connections and contribute to regional trade patterns.

- These countries may play key roles in regional trade blocs or economic partnerships, influencing trade dynamics within their respective regions.

- While not among the most influential in the global trade network, they have a moderate degree of influence on the network's structure and connectivity.

[Back to top](#) 

### Degree Distribution

```{r create-degree-dataframes}
# Country Exports Table
deg_df <- data.table(as_long_data_frame(g2000)[c("from_name", "to_name")])
out_deg_df <- deg_df[,.(cnt=.N),by=.(from_name)]
in_deg_df <- deg_df[,.(cnt=.N),by=.(to_name)]
```

#### Exports and Imports Distribution

```{r in-out-degree-plot, fig.cap="In and Out Degree Distribution"}
out_deg_table <- data.table(
  table(cut(out_deg_df$cnt, breaks = seq(0, 161, by=10), right = TRUE))
  )[(N)!=0] #remove bins that does not represent any country

# Create a histogram
a <- hist_plot(
  table=out_deg_table,
  title="Distribution of Exports",
  xlab="Export Range", 
  ylab="Frequency"
  )

in_deg_table <- data.table(
  table(cut(in_deg_df$cnt, breaks = seq(0, 161, by=10), right = TRUE)) #intervals are left-closed, meaning that the left endpoint is included in the interval, but the right endpoint is not
  )[(N)!=0] #remove bins that does not represent any country

# Create a histogram
b <- hist_plot(
  table=in_deg_table,
  title="Distribution of Imports",
  xlab="Import Range", 
  ylab="Frequency"
  )

ggarrange(a, b, ncol=1, nrow=2)
```

##### Exports Distribution

- The export distribution histogram is generally left-skewed. This means that there are more countries with higher export counts (toward the right side of the distribution) than with lower export counts (toward the left side of the distribution).

- If we look at the distribution from left to right, we can observe that the frequency counts generally decrease as we move from high export count ranges to low export count ranges. 

##### Imports Distribution

- Similar to the export distribution, the import distribution is also left-skewed; This means that there are more countries with higher import counts than with lower import counts

- 38 countries import from > 130 countries

- Most countries fall into the middle and lower import count ranges, indicating that the majority of countries have moderate to lower levels of imports. These countries may have smaller markets or lower consumer demand for imports.

Brief description of the degree distribution:

Based on Figure \@ref(fig:in-out-degree-plot)
We can understand that most countries are generally well connected. 

## Edge Attributes

### Trade Volume vs Ties

```{r create-volume-tables}
trade_df <- data.table(as_long_data_frame(g2000))[, c("weight", "from_name", "to_name")]

# Create export table
export_table <- trade_df[, .(total_export_volume = sum(weight), export_ties = .N), by = from_name]

# Create import table
import_table <- trade_df[, .(total_import_volume = sum(weight), import_ties = .N), by = to_name]

# Perform the outer join
vol_df <- merge(export_table, import_table, by.x = "from_name", by.y = "to_name", all = TRUE)

# Add 'export_vol_power' and 'import_vol_power' columns
vol_df[, export_vol_power := round(total_export_volume / (total_export_volume + total_import_volume), 3) * 100]
vol_df[, import_vol_power := round(total_import_volume / (total_export_volume + total_import_volume), 3) * 100]

#average export and import value per country
vol_df[, ave_export_vol := total_export_volume / export_ties ]
vol_df[, ave_import_vol := total_import_volume / import_ties ]

# Replace missing values (NA) with 0 in the resulting dataframe
vol_df[is.na(vol_df)] <- 0

# Rename country column
setnames(vol_df, old = "from_name", new = "country")

# Summary
knitr::kable(
  summary(vol_df),
  caption = "Export and Import Volume Summary"
)
```

#### Export Power Degree Distribution

```{r exp-vs-vol-plot, fig.cap="Export Ties vs Volume", eval=FALSE,  include=FALSE}
#we use a scatter plot to observe the relationship between the export volume and the number of export ties
ggplot(vol_df, aes(x=export_ties, y=total_export_volume)) +
  geom_point() +
  labs(
    title = "Export Ties vs Export Volume",
    x = "Number of Export Ties",
    y = "Total Export Volume per Country"
  )
```

Since the maximum export volume is significantly larger than the minimum export volume, let us try applying log transformation to the export volume, to minimise the absolute difference in export volumes, and try to observe any trends.

```{r log-transformed-exp-plot, fig.cap="Log transformed export volume against Export Ties",message=FALSE, warning=FALSE}

ex_vol_df <- vol_df[export_ties!=0]

#create scatter plot with line of best fit
ggplot(ex_vol_df, aes(x=export_ties, y=log(total_export_volume))) +
  geom_point() +
  geom_smooth(method=lm, se=FALSE) +
  labs(
    title = "Export Ties vs Export Volume",
    x = "Number of Export Ties",
    y = "Log(Total Export Volume per Country)"
  )
```

```{r lm-exports}
# Fit a linear regression model
model <- lm(log2(total_export_volume) ~ export_ties, data = ex_vol_df)

# Extract the slope coefficient
ex_slope_coefficient <- coef(model)[2]  # Extracts the coefficient for 'export_ties'
```

**Slope Coefficient of Best Fit line:** `r ex_slope_coefficient`

These are some deductions that can be made:

**Positive Linear Relationship: **
The log-transformed total export volume and the number of export ties show a positive linear relationship. As the number of export ties increases, the log-transformed export volume tends to increase as well. This suggests that there is a tendency for countries with more export ties to have higher export volumes.

**Magnitude of Change:** Since the dependent variable (total_export_volume) is log-transformed, we can interpret the coefficient as a percentage change in the original export volume. Specifically, a one-unit increase in export ties is associated with an estimated increase of approximately 8.04% in the original export volume (not on the log scale).

**Exponential Growth in Import Volume: **
The log transformation is often used to stabilize variance when dealing with data that spans several orders of magnitude. In this case, it helps reveal that the growth in export volume is not linear but rather exponential. As countries establish more export ties, their export volumes tend to grow exponentially.

```{r imp-vs-vol-plot, fig.cap="Import Ties vs Volume", eval=FALSE,  include=FALSE}
#we use a scatter plot to observe the relationship between the export volume and the number of export ties
ggplot(vol_df, aes(x=import_ties, y=total_import_volume)) +
  geom_point() +
  labs(
    title = "Import Ties vs Import Volume",
    x = "Number of Import Ties",
    y = "Total Import Volume per Country"
  )
```

Similarly, the maximum import volume is significantly larger than the minimum import volume, let us try applying log transformation to the import volume, to minimise the absolute difference in import volumes, and try to observe any trends.

```{r log-transformed-imp-plot, fig.cap="Log transformed import volume against Import Ties",message=FALSE, warning=FALSE}

im_vol_df <- vol_df[import_ties!=0]

#create scatter plot with line of best fit
ggplot(im_vol_df, aes(x=import_ties, y=log(total_import_volume))) +
  geom_point() +
  geom_smooth(method=lm, se=FALSE) +
  labs(
    title = "Import Ties vs Import Volume",
    x = "Number of Import Ties",
    y = "Log(Total Import Volume per Country)"
  )
```

```{r lm-imports}
# Fit a linear regression model
model <- lm(log2(total_import_volume) ~ import_ties, data = im_vol_df)

# Extract the slope coefficient
im_slope_coefficient <- coef(model)[2]  # Extracts the coefficient for 'export_ties'
```

**Slope Coefficient of Best Fit line:** `r im_slope_coefficient`

**Positive Linear Relationship: **
The log-transformed total import volume and the number of import ties show a positive linear relationship. As the number of import ties increases, the log-transformed import volume tends to increase as well. This suggests that there is a tendency for countries with more import ties to have higher import volumes.

**Magnitude of Change:** Since the dependent variable (total_import_volume) is log-transformed, we can interpret the coefficient as a percentage change in the original import volume. Specifically, a one-unit increase in import ties is associated with an estimated increase of approximately 10.66% in the original import volume (not on the log scale). 

**Note: This is greater than the estimated increase in original export volume with a one-unit increase in export ties.**

**Exponential Growth in Export Volume: **
As countries establish more import ties, their import volumes tend to grow exponentially.

[Back to top](#) 

# Qn 1b
```{r graph-structures-all-years }
# Step 1: Read the edge list from the .txt file
file_path_2005 <- here("indiv-project/trade-network/2005.net")
g2005 <- read_graph(file_path_2005,format="pajek")

file_path_2010 <- here("indiv-project/trade-network/2010.net")
g2010 <- read_graph(file_path_2010,format="pajek")

file_path_2015 <- here("indiv-project/trade-network/2015.net")
g2015 <- read_graph(file_path_2015,format="pajek")

file_path_2018 <- here("indiv-project/trade-network/2018.net")
g2018 <- read_graph(file_path_2018,format="pajek")

#sum weights in g2018 to remove multi-edges
g2018 <- simplify(g2018, edge.attr.comb = "sum") #sums weights of repeated edges
```


```{r define-functions }

graph_att <- function(graph, year){
  #this function returns a graph attributes in a data.table object
  df <- data.table::data.table(
    number_of_nodes=igraph::vcount(graph),
    number_of_edges=igraph::ecount(graph),
    density=igraph::graph.density(graph),
    diameter=igraph::diameter(graph),
    largest_component_size=max(igraph::components(graph)$csize),
    global_clustering_coeff=igraph::transitivity(graph,type="global"),
    ave_clustering_coeff=igraph::transitivity(graph,type="average"),
    number_of_cliques=igraph::clique_num(graph),
    year=year
  )
  return(df)
}


vertex_att <- function(graph, year){
  #this function returns some vertex attributes of a graph in a data.table object
   df <- data.table::data.table(
     vertex_id=igraph::V(graph),
     vertex_name=igraph::V(graph)$name,
     degree=igraph::degree(graph),
     closeness=igraph::closeness(graph),
     betweenness=igraph::betweenness(graph,normalized=T),
     transitivity=igraph::transitivity(graph,type="local"),
     eigen_centrality=igraph::eigen_centrality(graph)$vector,
     year=year
     )
   return(df)
}

get_top_5 <- function(df, col_of_interest){
  x <- order(data, na.last = TRUE, decreasing = FALSE)
  return(x[1:5, c("vertex_name", col_of_interest)])
}
```

## Graph Level Attributes

### Overall Summary

```{r graph-att-summary-years, message=FALSE, warning=FALSE}
g_list <- list(g2000, g2005, g2010, g2015, g2018)
years <- c("2000", "2005", "2010", "2015", "2018")

graph_att_df <- data.table()
#inititate for loop that will append graph attributes of all years
for (i in seq(1, 5)){
  graph <- g_list[[i]] #extract graph
  year <- years[i] #extract year
  graph_att_df <- rbindlist(list(graph_att_df, #existing graph attributes dataframe
                                 graph_att(g_list[[i]], years[i]) #bind new graph attributes
                                 )
                            )
}
knitr::kable(
  graph_att_df,
  caption = "Vertex Attributes 2000-2018"
)
```


From the above summary, it seems that the attributes that have undergone **relatively significant** changes:

1. Density
2. Diameter 
3. Number of cliques. 
4. Number of Edges

the attributes that have undergone **no change/ relatively insignificant** changes:

1. Number of Nodes
2. Largest Component Size
3. Global clustering coefficient
4. Average clustering Coefficient

[Back to top](#) 

```{r density-vs-time, fig.cap="Density Over Time"}
ggplot(graph_att_df, aes(x=year, y=density)) +
    geom_line( color="grey", group=1) +
    geom_point(shape=21, color="black", fill="#69b3a2", size=6) +
    theme_ipsum() +
    ggtitle("Evolution of Density")
```

**Note:** Since the number of countries in this trade network remains the same, it suffices to plot only number one out of edges vs density against time.

**Increasing Density (2000 to 2010):**

There is a noticeable increase in the network density, with the density rising from 0.634 to 0.721. This suggests that during this period, international trade became more interconnected. Several factors could contribute to this increase:

- **Globalization:** The early 21st century was marked by increased globalization, with countries engaging in more extensive trade relationships. Trade barriers may have been reduced, facilitating trade between nations.

- **Emerging Markets:** The rapid growth of emerging markets, such as China and India, led to expanded trade opportunities, contributing to the densification of the network.
  
- **Technological Advances:** Advances in transportation and communication technologies may have made it easier for countries to engage in international trade.

**Stabilization and Slight Decrease (2010 to 2015):**

After 2010, the density of the global trade network stabilizes and even experiences a slight decrease. It goes from 0.721 to 0.701. This phase may indicate a maturation of international trade relationships. Possible reasons include:

- **Economic Uncertainty:** The global financial crisis of 2008 had a significant impact on international trade. The decrease in density during this period may be related to economic uncertainties that led to reduced trade volumes.
  
- **Evolving Trade Agreements:** The landscape of international trade agreements and partnerships may have evolved, potentially altering the structure of trade networks.
  
- **Trade Policy Shifts:** Some countries may have implemented protectionist trade policies, impacting the density of trade connections.

**Moderate Decrease (2015 to 2018):**

From 2015 to 2018, there is a moderate decrease in network density, from 0.701 to 0.661. Several factors could contribute to this decline:

- **Trade Tensions:** During this period, there were escalating trade tensions between major economies, such as the United States and China. Trade disputes and tariff wars could have disrupted trade networks, reducing their density.
  
- **Economic Slowdown:** Global economic growth rates may have slowed down, affecting trade volumes. Reduced economic activity could lead to a reduction in the number of trade relationships.

[Back to top](#) 

```{r cliques-vs-time, fig.cap="Number of cliques Over Time"}
ggplot(graph_att_df, aes(x=year, y=number_of_cliques)) +
    geom_line( color="grey", group=1) +
    geom_point(shape=21, color="black", fill="#b3a369", size=6) +
    theme_ipsum() +
    ggtitle("Evolution of Number of Cliques")
```


**Steady Start (2000-2005):** The journey begins with a relatively stable number of 81 cliques in 2000, showing a modest increase to 87 by 2005. During this period, the trade networks exhibited a degree of stability in terms of cliques. Countries maintained relatively consistent trade partnerships.

**Gradual Growth (2005-2010):** The trend continues with a gradual increase in the number of cliques, reaching 96 by 2010. This period may reflect a growing complexity in trade relationships, potentially influenced by several factors:

**Global Economic Shifts:** The global economy was evolving, with emerging markets gaining prominence. These shifts could have led to the formation of new trade cliques as countries explored diverse partnerships.

**Sustained Complexity (2010-2015):** The number of cliques remains at 96 between 2010 and 2015, indicating a level of stability in trade relationships. During this time, countries likely continued to deepen their trade ties while maintaining existing ones.

**Marginal Increase (2015-2018):** The trend edges slightly upward, reaching 97 cliques in 2018. This small increase may be indicative of ongoing trade evolution, with countries exploring additional trade partnerships.

[Back to top](#) 


```{r diameter-vs-time, fig.cap="Diameter Over Time"}
ggplot(graph_att_df, aes(x=year, y=diameter)) +
    geom_line( color="grey", group=1) +
    geom_point(shape=21, color="black", fill="#bf546f", size=6) +
    theme_ipsum() +
    ggtitle("Evolution of Diameter")
```

**Steady Start (2000-2005):** The journey begins with a relatively stable diameter of 558.699 in 2000, dipping slightly to 533.426 by 2005. During this period, the trade network seemed well-connected, with most countries maintaining trade relationships.

**Dramatic Surge (2005-2010):** The real excitement unfolds between 2005 and 2010 when the diameter skyrockets to 4398.377. This surge suggests a significant expansion in trade connections. Several factors contribute:

- **Globalization Momentum:** The global economy was in full swing, with emerging markets like China and India playing pivotal roles. Their economic growth led to diverse trade links.

**Continued Growth (2010-2015):** The trend marches on, with the diameter reaching 8900.980 in 2015. This period signifies a deepening of trade relationships, further globalization, and economic interdependence.

**Exponential Expansion (2015-2018):** The most remarkable chapter unfolds from 2015 to 2018 when the diameter skyrockets to 29925.927. This exponential growth indicates an incredibly intricate and interconnected trade network. Here are some possible reasons for this trend:

- **Emerging Economies:** Emerging economies, especially in Asia and Africa, experienced rapid growth. Their economic prowess drove heightened trade activity and links with other nations.

- **Digital Commerce:** The rise of e-commerce and digital trade expanded the range of goods and services exchanged, creating additional trade connections.

[Back to top](#) 

# Qn 2a

```{r compute-diameter-function}
# Function to compute diameter after node removal
graph_deletion <- function(graph, removal_fraction, approach) {
  
  #this function takes in a graph object, the percentage of nodes to be removed, and the approach to deletion, namely "random" or "targeted"
  #targeted approach is using centrality 
  
  num_nodes_to_remove <- floor(vcount(graph) * removal_fraction) #round down number of ndoes to be removed
  
  # Create a copy of the original graph
  g_copy <- copy(graph)
  
  # Sort nodes by centrality measure if using targeted deletion
  if (approach == "targeted") {
    close_centr <- igraph::closeness(graph)
    nodes_to_remove <- order(close_centr, decreasing = TRUE)[1:num_nodes_to_remove]
  } else {
    # Randomly select nodes for removal
    nodes_to_remove <- sample(1:vcount(graph), num_nodes_to_remove)
  }
  
  # Remove selected nodes
  g_copy <- delete_vertices(g_copy, nodes_to_remove)
  
  return(g_copy)
}

```

```{r removal-fractions}
set.seed(32)
# Define a range of fractions for node removal
removal_fractions <- seq(0, 0.9, by = 0.1)
```

```{r}
# Function for graph deletion and plotting using ggplot2
graph_deletion_diameter_plot_ggplot <- function(graph, removal_fractions, year, title = TRUE, label = TRUE) {
  
  # Initialize data frame to store results
  result_data <- data.frame(Fraction = numeric(0), Diameter = numeric(0), Approach = character(0))
  
  # Perform node removal for each fraction and approach
  for (fraction in removal_fractions) {
    for (approach in c("random", "targeted")) {
      g_copy <- graph_deletion(graph, fraction, approach)
      diameter_value <- diameter(g_copy)
      result_data <- rbind(result_data, data.frame(Fraction = fraction, 
                                                   Diameter = diameter_value, 
                                                   Approach = approach))
    }
  }

  # Create a ggplot2 plot
  plot <- ggplot(result_data, aes(x = Fraction, y = Diameter, color = Approach)) +
    geom_line() +
    xlab("Fraction of Nodes Removed") +
    ylab("Diameter") +
    scale_color_manual(values = c("blue", "red")) +
    theme_minimal()
  
  # Add a title if title = TRUE
  if (title) {
    plot <- plot + ggtitle(paste("Change in Diameter vs. Node Removal", year))
  } else {
    plot <- plot + ggtitle(year)
  }
  
  # Show the legend if label = TRUE
  if (label) {
    plot <- plot + labs(color = "Approach") +
      theme(legend.position = "top",
            legend.justification='left',
            legend.direction='horizontal')
  }
  
  return(plot)
}
```

```{r graph-plot}
graph_deletion_diameter_plot_ggplot(g2018, removal_fractions, "2018")
```

[Back to top](#) 

# Qn 2b

In addition to diameter, another attribute that can potentially measure the resilience of the trade network to node removals is the "Size of the Giant Component" or "Size of the Largest Connected Component."

The Size of the Giant Component represents the number of nodes within the largest connected component of the network after node removal. A higher Size of the Giant Component indicates a more resilient network because it signifies that a larger portion of the network remains connected despite node removals.

```{r compute-giant-component-function}
# Function to compute Size of the Giant Component after node removal
compute_giant_component_after_removal <- function(graph, removal_fraction, approach) {
  num_nodes_to_remove <- floor(vcount(graph) * removal_fraction)
  
  # Create a copy of the original graph
  g_copy <- copy(graph)
  
  # Sort nodes by centrality measure if using targeted deletion
  if (approach == "targeted") {
    centrality <- igraph::closeness(graph)
    nodes_to_remove <- order(centrality, decreasing = TRUE)[1:num_nodes_to_remove]
  } else {
    # Randomly select nodes for removal
    nodes_to_remove <- sample(1:vcount(graph), num_nodes_to_remove)
  }
  
  # Remove selected nodes
  g_copy <- delete_vertices(g_copy, nodes_to_remove)
  
  # Compute and return the size of the giant component of the modified graph
  largest_component <- clusters(g_copy)$csize
  max(largest_component)
}
```

```{r t-test-function}
giant_component_ttest <- function(graph, removal_fractions, significance_val=0.05){
  # Initialize vectors to store the Size of the Giant Component
  giant_component_random <- numeric(length(removal_fractions))
  giant_component_targeted <- numeric(length(removal_fractions))

  # Perform computation for Size of the Giant Component after node removal
  for (i in 1:length(removal_fractions)) {
    fraction <- removal_fractions[i]
    
    # Random node deletion approach
    giant_component_random[i] <- compute_giant_component_after_removal(graph, fraction, "random")
    
    # Targeted node deletion approach
    giant_component_targeted[i] <- compute_giant_component_after_removal(graph, fraction, "targeted")
  }
  
  # Perform t-test to compare the means of the Size of the Giant Component for random and targeted deletions
  t_test_result <- t.test(giant_component_random, giant_component_targeted, alternative = "two.sided")
  }
```


```{r 2018-giant-component-ttest}

result <- giant_component_ttest(g2018, removal_fractions, significance_val=0.05)

# Print the results of the t-test
cat("T-test results:\n")
print(result)
```

In summary, the t-test results show that there is **no strong evidence** to conclude that the means of the Size of the Giant Component for random and targeted node deletions are significantly different. The relatively high p-value (0.8361) suggests that the observed difference in means could be due to random variation, and it is **not statistically significant**.

[Back to top](#) 

```{r import-graphs}
file_path_2000 <- here("indiv-project/trade-network/2000.net")
g2000 <- read_graph(file_path_2000,format="pajek")

file_path_2005 <- here("indiv-project/trade-network/2005.net")
g2005 <- read_graph(file_path_2005,format="pajek")

file_path_2010 <- here("indiv-project/trade-network/2010.net")
g2010 <- read_graph(file_path_2010,format="pajek")

file_path_2015 <- here("indiv-project/trade-network/2015.net")
g2015 <- read_graph(file_path_2015,format="pajek")
```

# Qn 2c


```{r deletion-plot-over-the-years}
# Create a list of graph objects
graph_list <- list(g2000, g2005, g2010, g2015, g2018)

# Create a list of years
years <- c("2000", "2005", "2010", "2015", "2018")

# Initialize an empty data frame to store the results
result_data <- data.frame()

# Loop through each graph and year
for (i in 1:length(graph_list)) {
  graph <- graph_list[[i]]
  year <- years[i]
  
  # Perform node removal for each fraction and approach
  for (fraction in removal_fractions) {
    for (approach in c("random", "targeted")) {
      g_copy <- graph_deletion(graph, fraction, approach)
      diameter_value <- diameter(g_copy)
      result_data <- rbind(result_data, data.frame(Fraction = fraction, Diameter = diameter_value, Approach = approach, Year = year))
    }
  }
}

# Create a ggplot2 plot using facet_grid
plot <- ggplot(result_data, aes(x = Fraction, y = Diameter, color = Approach)) +
  geom_line() +
  xlab("Fraction of Nodes Removed") +
  ylab("Change in Diameter") +
  scale_color_manual(values = c("blue", "red")) +
  theme_minimal() +
  facet_wrap(Year ~ ., ncol=5) 

# Show the plot
print(plot)

```

We can see that across the years, there was a **highly significant** change in diameter of the graph is highest in 2015 followed by 2018. However, when we compare them against the years 2000 - 2010, there was **minimal difference** in the change in diameter as the nodes were deleted. In 2000 and 2010, there was a slight spike in the change of diameter after the fraction of nodes deleted increased past ~ 0.7.

This tells us that **between 2000-2010**, the network was **much more resilient** as compared to **after the year 2015**.

```{r p-value-function}
get_p_value <- function(ttest){
  return(ttest$p.value)
}
```

```{r t-test-over-the-years}

ttest_years <- data.frame(
  year = c("2000", "2005", "2010", "2015", "2018"),
  p_value = c(
    get_p_value(giant_component_ttest(g2000, removal_fractions, significance_val=0.05)),
    get_p_value(giant_component_ttest(g2005, removal_fractions, significance_val=0.05)),
    get_p_value(giant_component_ttest(g2010, removal_fractions, significance_val=0.05)),
    get_p_value(giant_component_ttest(g2015, removal_fractions, significance_val=0.05)),
    get_p_value(giant_component_ttest(g2018, removal_fractions, significance_val=0.05))
  )
)

knitr::kable(
  ttest_years,
  caption = "T-test Over the Years"
)
```

In summary, the t-test results show that there is **no strong evidence** to conclude that the means of the Size of the Giant Component for random and targeted node deletions are significantly different across all the years. However, it is weird to note that the p-value of these t-tests remain the same from the year 2000 to 2015, only changing in 2015.

```{r t-test-check, include=FALSE}
# seconday check of t-test
giant_component_random2000 <- numeric(length(removal_fractions))
giant_component_targeted2000 <- numeric(length(removal_fractions))

giant_component_random2005 <- numeric(length(removal_fractions))
giant_component_targeted2005 <- numeric(length(removal_fractions))

giant_component_random2010 <- numeric(length(removal_fractions))
giant_component_targeted2010 <- numeric(length(removal_fractions))

giant_component_random2015 <- numeric(length(removal_fractions))
giant_component_targeted2015 <- numeric(length(removal_fractions))

giant_component_random2018 <- numeric(length(removal_fractions))
giant_component_targeted2018 <- numeric(length(removal_fractions))
  
for (i in 1:length(removal_fractions)) {
    fraction <- removal_fractions[i]
    
    # Random node deletion approach
    giant_component_random2000[i] <- compute_giant_component_after_removal(g2000, fraction, "random")
    giant_component_random2005[i] <- compute_giant_component_after_removal(g2005, fraction, "random")
    giant_component_random2010[i] <- compute_giant_component_after_removal(g2010, fraction, "random")
    giant_component_random2015[i] <- compute_giant_component_after_removal(g2015, fraction, "random")
    giant_component_random2018[i] <- compute_giant_component_after_removal(g2018, fraction, "random")

    
    # Targeted node deletion approach
    giant_component_targeted2000[i] <- compute_giant_component_after_removal(g2000, fraction, "targeted")
    giant_component_targeted2005[i] <- compute_giant_component_after_removal(g2005, fraction, "targeted")
    giant_component_targeted2010[i] <- compute_giant_component_after_removal(g2010, fraction, "targeted")
    giant_component_targeted2015[i] <- compute_giant_component_after_removal(g2015, fraction, "targeted")
    giant_component_targeted2018[i] <- compute_giant_component_after_removal(g2018, fraction, "targeted")


    }

giant_component_random2000
giant_component_targeted2000


giant_component_random2005
giant_component_targeted2005

giant_component_random2010
giant_component_targeted2010

giant_component_random2015
giant_component_targeted2015

giant_component_random2018
giant_component_targeted2018
```


[Back to top](#) 

# Task 2 qn 1

I do believe the key findings of this article, particularly the idea that obesity can spread through social networks. This is consistent with the broader understanding of how behaviors and attitudes can spread within social groups. However, the extent to which these findings can be generalized to the broader population may vary.

**More Likely to Hold True:**

**Existence of Obesity Clusters:** 

The concept of homophily, or "birds of a feather flock together", is a well-established principle in sociology. For example, studies have shown that people often form friendships with those who share similar characteristics, such as age, race, religion, and socioeconomic status. In the context of obesity, it's plausible that individuals with similar dietary habits, physical activity levels, and attitudes towards health would form social connections, leading to clusters of obesity.

**Influence of Social Ties:** 

The finding that a person's chances of becoming obese increase if a friend, sibling, or spouse becomes obese also seems likely to hold true. The influence of social ties on behaviors and attitudes is well-documented. For instance, studies on smoking and alcohol consumption have shown that these behaviors can spread within social networks. If a person's friends or family members smoke or drink heavily, they are more likely to adopt these behaviors themselves. Similarly, if a person's social ties become obese, they may adopt similar lifestyle habits, leading to weight gain.

**Less Likely to Hold True:**

**Same-Sex Influence:** 

While the study found that same-sex individuals have a greater influence on each other's obesity status, this may not be universally applicable. For example, in societies with strict gender roles, men and women may have different lifestyle habits and social norms related to diet and physical activity, which could influence obesity rates differently. Additionally, individual personality traits and personal preferences could also play a role in the influence of same-sex relationships on obesity.

**Lack of Neighbor Influence:** 

The study found no significant influence of neighbors on an individual's obesity status. This may not be universally applicable. In different geographical or cultural contexts, neighbors might play a more significant role, especially where community activities and interactions are common. The study found no significant influence of neighbors on an individual's obesity status. However, this may not hold true in all contexts. For example, in communities where neighbors frequently interact and participate in communal activities, such as neighborhood potlucks or group exercise classes, neighbors could potentially have a significant influence on each other's lifestyle habits and, consequently, obesity status.

For example, based on my personal experience, on anecdotal evidence, "Kampong" environments in rural areas within Malaysia, have a high proportion of obese individuals, and the community is tightly connected, with often many house visits and community events such as weddings from time to time. Such a study should also keep in mind the cultural differences within the community of interest.

[Back to top](#) 

# Task 2 qn 2

**Same Research Question:**

- "How does obesity spread through social networks?"

**Data Collection:**

**1. Diverse Community Selection:**

   - To capture a more comprehensive view, the study should include diverse types of communities, such as urban and rural areas, as well as communities that vary in socioeconomic status, from extremely affluent to low-income neighborhoods. This diversity will help identify how obesity spreads across different social and economic contexts.

**2. Network Data:**

   - Collect extensive data on the social networks in these communities, including details on friendships, family connections, and professional relationships. This data will be gathered through surveys, interviews, and participant observation.

**3. Technological Tools:**

   - Incorporate technological tools to enhance data collection accuracy and real-time monitoring:
     
     - **Social Media Platforms:** Use social media data to map online social networks. Platforms like Facebook, Twitter, and LinkedIn can provide valuable information about digital connections.
     
     - **Wearable Technology:** Distribute wearable devices (e.g., fitness trackers) to participants to collect real-time data on lifestyle habits, physical activity, and health-related metrics. These devices can also track in-person interactions, as some offer proximity sensing.

**4. Survey and Questionnaire Data:**

   - Administer detailed surveys and questionnaires to participants to collect information on individual-level characteristics, including age, gender, BMI, dietary habits, physical activity, and health history. These surveys should be administered at multiple time points to track changes.

**5. Social Interaction Logs:**

   - Develop mobile apps or tools that allow participants to log their social interactions and the context of those interactions. These logs can provide insights into the frequency and nature of social connections.

**Data Analysis:**

**1. Network Analysis:**

   - Use network analysis techniques to identify clusters of obesity within the communities. Analyze the influence of social ties on weight changes by examining network centrality, density, and modularity.

**2. Statistical Analysis:**

   - Employ advanced statistical methods to:
   
     - Model the likelihood of obesity transmission within and between communities, considering factors like the strength of social ties and geographical proximity.
     
     - Control for potential confounding variables, including age, gender, socioeconomic status, and community type (urban/rural, affluent/poor).
     
     - Explore interaction effects to understand how various factors collectively influence obesity spread.

**3. Longitudinal Analysis:**

   - Perform longitudinal data analysis to track the temporal aspects of obesity transmission over time in different communities.

**Interpretation and Conclusions:**

   - Summarize findings on the spread of obesity, with a focus on variations across different community types.
   
   - Identify key influencers and clusters in each community, and analyze their impact on obesity transmission.
   
   - Draw conclusions about the factors contributing to the spread of obesity and their implications for public health strategies in various contexts.

**Practical Implications:**

   - Translate research findings into practical interventions, customized for each community type, and consider potential public health policies tailored to specific needs.

This comprehensive research design would allow for a more nuanced understanding of how obesity spreads through social networks in diverse communities and provide insights into the role of technological tools and advanced statistical analysis in public health research.

[Back to top](#) 
